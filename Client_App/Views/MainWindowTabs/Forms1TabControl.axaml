<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
			 xmlns:controls="clr-namespace:Client_App.Views.Controls"
	         xmlns:models="clr-namespace:Models.Collections;assembly=Models"
			 xmlns:converter="clr-namespace:Client_App.VisualRealization.Converters"
			 xmlns:interactivity="clr-namespace:Avalonia.Xaml.Interactivity;assembly=Avalonia.Xaml.Interactivity"
			 xmlns:behaviors="using:Avalonia.Xaml.Interactions.Core"
			 xmlns:local="using:Client_App.Behaviors"
			 xmlns:vm="using:Client_App.ViewModels.MainWindowTabs"
			 xmlns:customConverters="clr-namespace:Client_App.Resources.CustomConverters"
			 xmlns:viewModels="clr-namespace:Client_App.ViewModels"
			 x:DataType="vm:Forms1TabControlVM"
             x:Class="Client_App.Views.MainWindowTabs.Forms1TabControl">

	<UserControl.Resources>
        <customConverters:BoolInverterConverter x:Key="BoolInverterConverter"/>
        <converter:IfNullShowAnotherValue x:Key="IfNullShowAnotherValue"/>
	</UserControl.Resources>

    <Design.DataContext>
        <vm:Forms1TabControlVM/>
    </Design.DataContext>
	
	<Border Classes="borderContainer">
		<Grid RowDefinitions="*,*" ColumnDefinitions="5*,3*" >
			<Grid Grid.Row ="0" Grid.Column="0" RowDefinitions="Auto,*,Auto">
				<TextBox Text="{Binding SearchText}" Grid.Row="0" Margin="5" Watermark ="Поиск..." />
				<DataGrid x:Name="ReportsDataGrid"
						  Grid.Row="1" Margin="5"
						  Items="{Binding ReportsCollection}"
						  SelectionMode="Single"
						  SelectedItem="{Binding SelectedReports}"
						  RowHeight="25"
						  GridLinesVisibility="All"
						  AlternatingRowBackground="White"
						  RowBackground="White"
						  CanUserSortColumns="False">
					
					<interactivity:Interaction.Behaviors>
						<local:DataGridDoubleClickOpenFormBehavior />
					</interactivity:Interaction.Behaviors>

					<DataGrid.ContextMenu>
						<ContextMenu>
							<ContextMenu.Styles>
								<Style Selector="MenuItem">
									<Setter Property="Background" Value="WhiteSmoke"/>
									<Setter Property="BorderThickness" Value="0"/>
									<Setter Property="FontSize" Value="14"/>
								</Style>
							</ContextMenu.Styles>
							<MenuItem Header="Добавить форму"
									  Command="{Binding MainWindowVM.AddReports}"/>
							<MenuItem Header="Редактировать форму"
									  Command="{Binding MainWindowVM.NewChangeReports}"/>

                            <MenuItem Header="Импортировать отчёт в организацию">
                                <MenuItem Header="Из RAODB"
                                          Click="ImportRaodb_Click"/>
                                <MenuItem Header="Из Excel"
                                          Click="ImportExcel_Click"/>
                            </MenuItem>

							<MenuItem Header="Удалить форму"
									  Command="{Binding MainWindowVM.DeleteReports}"
									  CommandParameter="{Binding SelectedReports}"/>
							<MenuItem Header="Выгрузить организацию"
									  Command="{Binding MainWindowVM.ExportReports}"
									  CommandParameter="{Binding SelectedReports}"/>
							<MenuItem Header="Выгрузить организацию с указанием диапазона дат"
									  Command="{Binding MainWindowVM.ExportReportsWithDateRange}"
									  CommandParameter="{Binding SelectedReports}"/>
							<MenuItem Header="Выгрузить все организации в один файл"
									  Command="{Binding MainWindowVM.ExportAllReportsOneFile}"/>
							<MenuItem Header="Выгрузить все организации в отдельные файлы"
									  Command="{Binding MainWindowVM.ExportAllReports}"
									  CommandParameter="{Binding SelectedReports}"/>
							<MenuItem Header="Проверить все формы организации"
									  Command="{Binding MainWindowVM.ExcelExportCheckAllForms}"
									  CommandParameter="{Binding SelectedReports}"/>
						</ContextMenu>
					</DataGrid.ContextMenu>

					<DataGrid.Columns>
						<DataGridTemplateColumn Width="60" IsReadOnly="True">
							<DataGridTemplateColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Рег. №"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.HeaderTemplate>
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate x:DataType="models:Reports">
									<TextBlock Margin="5" Text="{Binding Master.RegNoRep.Value}"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
						
						<DataGridTemplateColumn Width="*" IsReadOnly="True">
							<DataGridTemplateColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Сокращенное наименование"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.HeaderTemplate>
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate x:DataType="models:Reports">
									<TextBlock Margin="5">
										<TextBlock.Text>
											<MultiBinding Converter="{StaticResource IfNullShowAnotherValue}">
												<Binding Path="Master.Rows10[1].ShortJurLico.Value"/>
												<Binding Path="Master.Rows10[0].ShortJurLico.Value"/>
											</MultiBinding>
										</TextBlock.Text>
									</TextBlock>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

						<DataGridTemplateColumn Width="100" IsReadOnly="True">
							<DataGridTemplateColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="ОКПО"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.HeaderTemplate>
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate x:DataType="models:Reports">
									<TextBlock Margin="5" Text="{Binding Master.OkpoRep.Value}"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

					</DataGrid.Columns>
				</DataGrid>
				<Border Grid.Row="2" Classes="pageControlContainer">
					<Grid
						  RowDefinitions="Auto,Auto"
						  ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
						<TextBlock Text="Текущая страница"
							Grid.Row="0" Grid.Column="0" Margin="5"
							VerticalAlignment="Center"/>

						<controls:NumericLeftRight
							Value="{Binding CurrentPageOrgs}"
							Grid.Row="0" Grid.Column="1" Margin="5"
							Minimum="1"/>
						<TextBlock Text ="Кол-во страниц:"
							Grid.Row="0" Grid.Column="2" Margin="5"
							VerticalAlignment="Center"/>
						<TextBlock
							Text="{Binding TotalPagesOrgs}"
							Grid.Row="0" Grid.Column="3" Margin="5"
							VerticalAlignment="Center"/>
						<TextBlock Text="Кол-во орг. на странице"
							Grid.Row="1" Grid.Column="0" Margin="5"
							VerticalAlignment="Center"/>
						<controls:NumericLeftRight
							Value="{Binding RowsCountOrgs}"
							Grid.Row="1" Grid.Column="1" Margin="5"
							Minimum="1"/>
						<TextBlock Text="Всего орг.:"
							Grid.Row="1" Grid.Column="2" Margin="5"
							VerticalAlignment="Center"/>
						<TextBlock
							Text="{Binding FilteredRowsOrgs}"
							Grid.Row="1" Grid.Column="3" Margin="5"
							VerticalAlignment="Center"/>

						<TextBlock Text="Всего отчетов:"
							Grid.Row="1" Grid.Column="4" Margin="5"
							VerticalAlignment="Center"/>
						<TextBlock Text="{Binding TotalReportCount}"
							Grid.Row="1" Grid.Column="5" Margin="5"
							VerticalAlignment="Center"/>
					</Grid>
				</Border>
			</Grid>
			<ScrollViewer Grid.Row ="0" Grid.Column="1" Margin="5">
				<StackPanel>
				
					<Button Margin="0,0,0,5" 
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.1"
							Content="Форма 1.1: Сведения о ЗРИ"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.2"
							Content="Форма 1.2: Сведения об изделиях из обедненного урана"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.3"
							Content="Форма 1.3: Сведения об ОРИ в виде отдельных изделий"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.4"
							Content="Форма 1.4: Сведения об ОРИ кроме отдельных изделий"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.5"
							Content="Форма 1.5: Сведения о РАО в виде отработавших ЗРИ"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.6"
							Content="Форма 1.6: Сведения о некондиционированных РАО"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.7"
							Content="Форма 1.7: Сведения о твердых кондиционированных РАО"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.8"
							Content="Форма 1.8: Сведения о жидких кондиционированных РАО"/>
					<Button Margin="0,0,0,5"
							Command="{Binding MainWindowVM.NewAddForm}"
							CommandParameter="1.9"
							Content="Форма 1.9: Сведения о результатах инвентаризации РВ не в составе ЗРИ"/>
				</StackPanel>
			</ScrollViewer>
			<Grid Grid.Row ="1" Grid.Column="0" Grid.ColumnSpan="2" RowDefinitions="*,Auto" >
				<DataGrid Grid.Row="0" Margin="5"
						  Items="{Binding ReportCollection}"
						  SelectedItem="{Binding SelectedReport}"
						  RowHeight="25"
						  GridLinesVisibility="All"
						  AlternatingRowBackground="White"
						  RowBackground="White"
						  CanUserSortColumns="False">
					<interactivity:Interaction.Behaviors>
						<local:DataGridDoubleClickOpenFormBehavior />
					</interactivity:Interaction.Behaviors>
					<DataGrid.ContextMenu>
						<ContextMenu>
							<MenuItem Header="Редактировать форму"
									  Command="{Binding MainWindowVM.NewChangeForm}"
									  CommandParameter="{Binding SelectedReport}"/>
							<MenuItem Header="Удалить форму"
									  Command="{Binding MainWindowVM.NewDeleteForm}"
									  CommandParameter="{Binding SelectedReport}"/>
							<MenuItem Header="Выгрузить форму в Excel"
									  Command="{Binding MainWindowVM.ExcelExportFormPrint}"
									  CommandParameter="{Binding SelectedReport}"/>
							<MenuItem Header="Выгрузить"
									  Command="{Binding MainWindowVM.ExportForm}"
									  CommandParameter="{Binding SelectedReport}"/>
							<MenuItem Header="Проверить форму"
									  Command="{Binding MainWindowVM.CheckFormFromMain}"
									  CommandParameter="{Binding SelectedReport}"/>
							<MenuItem Header="Сохранить комментарий"
									  Command="{Binding MainWindowVM.SaveReports}"
									  CommandParameter="{Binding SelectedReport}"/>
						</ContextMenu>
					</DataGrid.ContextMenu>

					<DataGrid.Columns>
						<DataGridTextColumn
								x:DataType="models:Report"
								Width="Auto"
								IsReadOnly="True"
								Binding="{Binding FormNum.Value}">
							<DataGridTextColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Форма"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTextColumn.HeaderTemplate>
						</DataGridTextColumn>
						<DataGridTextColumn
								x:DataType="models:Report"
								Width="*"
								IsReadOnly="True"
								Binding="{Binding StartPeriod.Value}">
							<DataGridTextColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Дата начала периода"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTextColumn.HeaderTemplate>
						</DataGridTextColumn>
						<DataGridTextColumn
								x:DataType="models:Report"
								Width="*"
								IsReadOnly="True"
								Binding="{Binding EndPeriod.Value}">
							<DataGridTextColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Дата конца периода"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTextColumn.HeaderTemplate>
						</DataGridTextColumn>
						<DataGridTextColumn
								x:DataType="models:Report"
								Width="*"
								IsReadOnly="True"
								Binding="{Binding ExportDate.Value}">
							<DataGridTextColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Дата выгрузки"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTextColumn.HeaderTemplate>
						</DataGridTextColumn>
						<DataGridTextColumn
								x:DataType="models:Report"
								Width="*"
								IsReadOnly="True"
								Binding="{Binding CorrectionNumber.Value}">
							<DataGridTextColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Номер корректировки"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTextColumn.HeaderTemplate>
						</DataGridTextColumn>
						<DataGridTextColumn
								x:DataType="models:Report"
								Width="2*"
								IsReadOnly="False"
								Binding="{Binding Comments.Value}">
							<DataGridTextColumn.HeaderTemplate>
								<DataTemplate>
									<Border Classes="headerTemplate">
										<Grid ColumnDefinitions="*,Auto" Margin="3">
											<TextBlock Grid.Column="0" Text="Комментарий"/>
											<!--<Button Grid.Column="1"/>-->
										</Grid>
									</Border>
								</DataTemplate>
							</DataGridTextColumn.HeaderTemplate>
						</DataGridTextColumn>
					</DataGrid.Columns>
				</DataGrid>
				<Border Grid.Row="1" Classes="pageControlContainer">
					<Grid
						  RowDefinitions="Auto,Auto"
						  ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto">
						<TextBlock Text="Текущая страница"
							Grid.Row="0" Grid.Column="0" Margin="5"/>

						<controls:NumericLeftRight
							Value="{Binding CurrentPageForms}"
							Grid.Row="0" Grid.Column="1" Margin="5"
							Minimum="1"/>
						<TextBlock Text ="Кол-во страниц:"
							Grid.Row="0" Grid.Column="2" Margin="5"/>
						<TextBlock Text="{Binding TotalPagesForms}"
							Grid.Row="0" Grid.Column="3" Margin="5"/>
						<TextBlock Text="Кол-во строчек на странице"
							Grid.Row="1" Grid.Column="0" Margin="5"/>
						<controls:NumericLeftRight
							Value="{Binding RowsCountForms}"
							Grid.Row="1" Grid.Column="1" Margin="5"
							Minimum="1"/>
						<TextBlock Text="Кол-во отчетов:"
							Grid.Row="1" Grid.Column="2" Margin="5"/>
						<TextBlock Text="{Binding TotalRowsForms}"
							Grid.Row="1" Grid.Column="3" Margin="5"/>

						<TextBlock Text="Кол-во строчек:"
							Grid.Row="1" Grid.Column="4" Margin="5"/>
						<TextBlock Text="{Binding InSelectedReportFormsCount}"
							Grid.Row="1" Grid.Column="5" Margin="5"/>

						<StackPanel Grid.Row="0" Grid.RowSpan="2"
									Grid.Column="6"
									Margin="5,0,0,0"
									Orientation="Horizontal">

							<Button Content="1.1" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.1"/>
							<Button Content="1.2" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.2"/>
							<Button Content="1.3" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.3"/>
							<Button Content="1.4" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.4"/>
							<Button Content="1.5" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.5"/>
							<Button Content="1.6" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.6"/>
							<Button Content="1.7" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.7"/>
							<Button Content="1.8" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.8"/>
							<Button Content="1.9" Width="35" Height="40" Margin="0,0,2,0"
									Command="{Binding MainWindowVM.GoToFormNum}" CommandParameter="1.9"/>
						
						</StackPanel>
					</Grid>
				</Border>
			</Grid>
		</Grid>
	</Border>
</UserControl>
